<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Infinity Portal</title>
  <style>
    body { font-family: sans-serif; background: #111; color: #eee; text-align: center; }
    h1 { color: #6cf; }
    #note { font-size: 2em; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Infinity Portal</h1>
  <p>First module: Pitch Detector</p>
  <button id="startBtn">Start Listening</button>
  <div id="note">ðŸŽµ Waiting...</div>

  <script>
    const noteElem = document.getElementById('note');
    const startBtn = document.getElementById('startBtn');

    const noteStrings = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];

    function getNote(freq) {
      const A4 = 440;
      const semitone = 69 + 12 * Math.log2(freq / A4);
      return Math.round(semitone);
    }

    function noteFromPitch(freq) {
      const noteNum = getNote(freq);
      return noteStrings[noteNum % 12];
    }

    async function start() {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      const audioCtx = new AudioContext();
      const source = audioCtx.createMediaStreamSource(stream);
      const analyser = audioCtx.createAnalyser();
      source.connect(analyser);

      const bufferLength = analyser.fftSize = 2048;
      const data = new Float32Array(bufferLength);

      function update() {
        analyser.getFloatTimeDomainData(data);
        let max = 0, idx = 0;
        for (let i = 0; i < data.length; i++) {
          if (Math.abs(data[i]) > max) { max = Math.abs(data[i]); idx = i; }
        }
        // crude pitch estimate
        const freq = audioCtx.sampleRate / idx;
        if (freq > 50 && freq < 2000) {
          noteElem.textContent = "Note: " + noteFromPitch(freq);
        }
        requestAnimationFrame(update);
      }
      update();
    }

    startBtn.onclick = start;
  </script>
</body>
</html>